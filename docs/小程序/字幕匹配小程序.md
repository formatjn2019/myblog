字幕匹配小程序

最初是想写个简单的脚本去将原盘中的内容和字幕匹配的，后来发现有些媒体文件也需要进行匹配，索性写了个比较基本达到我使用要求的小东西。

[下载地址](https://github.com/formatjn2019/MatchSubtitles/releases)

这里做个简单的讲解示例，不然很容易不知道这东西该怎么用



首先说参数

#### 参数

```shell
[-h --help] 帮助
[-b --bdmv] 原盘的路径，如果不是所有原盘文件在同一个目录下，可指定多个光盘路径，注意命名，程序可能会识别错误的顺序
[-c --copy] 复制字幕（加上仅仅会复制字幕，媒体文件该移动的还是移动）
[-d --debug] debug 调试
[-e --each] each 每个bdmv文件夹下有多少个媒体文件，必须跟-f联用
[-f --force] force 强制执行
[-l --hardlink] hardlink 硬链接
[-n --num] number 指定媒体文件数量，跟f连用，仅用在移动媒体文件且没有字幕的时候
[-pf --prefix] prefix 前缀 指定目标文件夹时 增加前缀
[-p --print] 仅打印 不进行具体的操作
[-sf --suffix] suffix 后缀
[-r --reverse] reverse 翻转 可用于翻译字幕时简中转繁中 以及原盘模式下和-f联用
[-s --subtitle] subtitle 字幕所在文件夹
[-tr --translate] translate 翻译 如果翻译，程序同级文件夹下必须有rule.csv文件。
[-t --target] target path 移动到目标文件夹
[-V --version] version 版本号
[-v --verbosity] verbosity 显示匹配的详细过程
[-m --media] media path 媒体文件夹
```

#### 参数解释

* 为什么 `-c`参数只复制字幕
  
  *  媒体文件太大，复制太慢了
  
  * 而且复制会造成硬链接失效
  
  * 建议复制一份或者硬链接一份后再用这个程序添加字幕，防止手抖或者程序错误造成难以挽回的后果

* `-tr` 是翻译什么的
  
  * 简中繁中相互转换，通过rule.csv中的文件内容进行简单替换（简单替换可能导致错误，建议实在找不到需要的字幕了再用，另，如果是双语字幕，也会其他的语言也替换掉的，这个功能就一般当摆设就好了）。
  
  * rule.csv可以用excel或者记事本打开，后面加上自定义的替换。
  
  * 使用翻译命令时，一定要有rule.csv文件，否则翻译无效

* -l 硬链接有时会失败
  
  * 硬链接不能跨卷，比如c盘和d盘不能链接
  
  * 存在同名文件导致链接失败
  
  * 以及硬链接数量有上限（一般人不会触发到这个上限的）等原因，所以我一直懒得做这东西，但用着用着发现还是加上方便。。。

#### 使用方式

##### 打包好的文件：

`二进制文件名 参数`

如windows  `.\match_subtitles.exe -s . -tr`  翻译当前目录下的所有字幕文件

##### 源码

系统安装python3

pip安装 argparse : `pip install argparse`

使用： `python ./match_subtitle.py 参数`

`python match_subtitles.py -s . -tr` 翻译当前目录下的所有字幕文件

#### 命令组合

###### 翻译字幕

以下命令加`-r`代表简中转繁中，不加代表繁中转简中

`match_subtitles -s 字幕目录 -tr` 翻译并替换原文件

`match_subtitles -s 字幕目录 -tr -t 目标目录` 将翻译后的文件保存到新目录

###### 匹配媒体

`match_subtitles -s 字幕目录 -m 视频目录` 匹配字幕文件到视频目录

###### 匹配原盘中的视频文件

1. `match_subtitles -s 字幕目录 -b 原盘目录` 匹配字幕文件到原盘目录

~~这种参数要求字幕数量恰好等于光盘文件夹数量~~，v 0.1.0 更改了匹配规则，能匹配绝大多数的文件了（但是不一定准，有能力（且手上原盘多）的建议在setting文件里改下参数试试）

2. `match_subtitles -s 字幕目录 -b 原盘目录 -f` 强制匹配字幕文件到原盘目录。比如25集放了8个光盘，13集放了3个光盘，多的集数在最后一个，能匹配到。以25,8为例 最后匹配的序列为 `3 3 3 3 3 3 3 4`

3. `match_subtitles -s 字幕目录 -b 原盘目录 -f -r` 强制匹配字幕文件到原盘目录。比如25集放了8个光盘，13集放了6个光盘，多的集数在第一个。以13，6为例 最后匹配的序列为 `3 2 2 2 2 2`

4. `match_subtitles -s 字幕目录 -b 原盘目录 -f -e 每个光盘数量` 强制匹配字幕文件到原盘目录。 比如11集放了6个光盘，12集放了7个光盘 指定数量后会自动忽略后面的。以12,7为例，指定-e为2 最后匹配的序列为`2 2 2 2 2 2 0`

匹配媒体和匹配原盘的参数可以额外加上

* -p 只显示，不移动

* -c 复制字幕，不移动字幕

* -t 所有文件移动到目标目录
  
  * -pf 前缀
  
  * -sf 后缀

###### 移动视频文件到指定目录

`match_subtitles -m 原盘目录 -t 目标目录` 对应带字幕的原盘匹配规则1

`match_subtitles -m 原盘目录 -t 目标目录 -f -n 文件数量` 对应带字幕的原盘匹配规则2

`match_subtitles -m 原盘目录 -t 目标目录 -f -n 文件数量 -r` 对应带字幕的原盘匹配规则3

`match_subtitles -m 原盘目录 -t 目标目录 -f -n 文件数量 -e 每个数量` 对应带字幕的原盘匹配规则4

-p -t 同样适用于这个



#### 注意事项

* 媒体文件的命名要规范，如果是后面有许多花絮之类的应该删掉，不然规则容易匹配不到，字幕同理。

* 如果比较奇怪的命名，比如`***第1集***，***第2集***...***第n集***，***ova***`建议检查视频文件中是否有ova集字幕对应的视频，可改成`***第n+1集***`方便匹配，媒体文件同理。不过两边命名规则一致也可以匹配的上。

* 原盘文件夹注意检查顺序，因为小写的ova排序靠前，然后就匹配错误了。可以手动改名或者使用多个-v参数按顺序录入光盘文件。比如`match_subtitles -b 第一个光盘文件夹 -b 第二个光盘文件夹 ....`
